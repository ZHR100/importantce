<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script src="./jquery.js"></script>
    <script>
        // 回调地狱
        // 后面的接口参数是从前一个接口获取的
        // $.ajax({
        //     url: 'http://127.0.0.1:7111/wangyiyun/toplist',
        //     success: function (res) {
        //         console.log(res);
        //         var id = res.list[0].id
        //         console.log(id);
        //         $.ajax({
        //             url: 'http://127.0.0.1:7111/wangyiyun/playlist/detail?id=' + id,
        //             success: function (res) {
        //                 console.log(res);
        //             }
        //         })
        //     }
        // })

        // Promise参数是一个函数
        // 这个函数有默认的两个形参，resolve和reject，这两个形参本身是函数
        // resolve() 执行resolve，代码会跑到.then方法，resolve传递的参数就可以在then回调获取
        // reject() 执行reject,代码会跑到.catch方法
        // new Promise(function(resolve, reject) {
        //     resolve(2)
        //     reject(3)
        // }).then(function(res) {
        //     console.log(res);
        // }).catch(function(err) {
        //     console.log(err);
        // })

        // new Promise((resolve, reject) => {
        //     $.ajax({
        //         url: 'http://127.0.0.1:7111/wangyiyun/toplist',
        //         success: function (res) {
        //             resolve(res.list[0].id)
        //         }
        //     })
        // }).then(res => {
        //     return new Promise((resolve, reject) => {
        //         $.ajax({
        //             url: 'http://127.0.0.1:7111/wangyiyun/playlist/detail?id=' + res,
        //             success: function (res) {
        //                 resolve(res)
        //             }
        //         })
        //     })
        // }).then(res => {
        //     console.log(res);
        // })

        // function getToplist() {
        //     return new Promise((resolve, reject) => {
        //         $.ajax({
        //             url: 'http://127.0.0.1:7111/wangyiyun/toplist',
        //             success: function (res) {
        //                 resolve(res.list)
        //             }
        //         })
        //     })
        // }

        // getToplist().then(res => {
        //     console.log(res);
        // })

        // Promise.all(), 参数传一个Promise数组
        // 需要获取三个接口的数据，然后一起处理
        console.time('请求时间x');
        $.ajax({
            url: 'http://127.0.0.1:3000/one',
            success: function (res1) {
                $.ajax({
                    url: 'http://127.0.0.1:3000/two',
                    success: function (res2) {
                        $.ajax({
                            url: 'http://127.0.0.1:3000/three',
                            success: function (res3) {
                                console.log(res1, res2, res3);
                                console.timeEnd('请求时间x')
                            }
                        })
                    }
                })
            }
        })

        console.time('请求时间y')
        Promise.all([
            new Promise((resolve, reject) => {
                $.ajax({
                    url: 'http://127.0.0.1:3000/one',
                    success: res => {
                        resolve(res)
                    }
                })
            }),
            new Promise((resolve, reject) => {
                $.ajax({
                    url: 'http://127.0.0.1:3000/two',
                    success: res => {
                        resolve(res)
                    }
                })
            }),
            new Promise((resolve, reject) => {
                $.ajax({
                    url: 'http://127.0.0.1:3000/three',
                    success: res => {
                        resolve(res)
                    }
                })
            })
        ]).then(res => {
            console.log(res);
            console.timeEnd('请求时间y')
        })
    </script>
</body>

</html>